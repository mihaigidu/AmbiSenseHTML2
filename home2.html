<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Panel de Usuario</title>
</head>
<body>
    <h1>Panel de Control</h1>
    <p id="welcomeMessage">Bienvenido, tu sesión está activa.</p>

    <button onclick="logout()">Cerrar Sesión</button>

    <h2>Usuarios Registrados</h2>
    <ul id="userList"></ul>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const token = localStorage.getItem('jwtToken');
            if (!token) {
                alert('No estás autenticado. Redirigiendo al login.');
                window.location.href = 'http://52.200.144.251/login2.html';
                return;
            }

            fetch('http://ambisensepruebaapi.us-east-1.elasticbeanstalk.com/auth/user', {
                method: 'GET',
                headers: { 'Authorization': `Bearer ${token}` }
            }).then(response => {
                if (!response.ok) throw new Error('Token inválido');
                return response.json();
            }).then(data => {
                document.getElementById('welcomeMessage').innerText = `Bienvenido, ${data.name}`;
                loadUsers();
            }).catch(error => {
                console.error('Error:', error);
                localStorage.removeItem('jwtToken');
                window.location.href = 'http://52.200.144.251/login2.html';
            });
        });

        function logout() {
            localStorage.removeItem('jwtToken');
            alert('Sesión cerrada.');
            window.location.href = 'http://52.200.144.251/login2.html';
        }

        function loadUsers() {
            const token = localStorage.getItem('jwtToken');
            fetch('http://ambisensepruebaapi.us-east-1.elasticbeanstalk.com/public/users', {
                method: 'GET',
                headers: { 'Authorization': `Bearer ${token}` }
            }).then(response => response.json())
            .then(users => {
                const userList = document.getElementById('userList');
                users.forEach(user => {
                    const li = document.createElement('li');
                    li.textContent = `${user.name} - ${user.email}`;
                    userList.appendChild(li);
                });
            }).catch(error => console.error('Error cargando usuarios:', error));
        }
    </script>
</body>
</html>