<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Página de Sensores</title>
    <link rel="icon" href="imagenes/FavIcon.png" type="image/x-icon">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link rel="stylesheet" href="css/header.css">
    <script defer src="js/header.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
    <!-- CSS del Footer -->
    <link rel="stylesheet" href="css/footer.css">
    <link rel="stylesheet" href="css/mainUsuario.css">
    <!-- JS del Footer -->
    <script src="js/footer.js" defer></script>
    <script defer src="js/modoOscuro.js"></script>
    <script defer src="js/mainUsuario.js"></script>

</head>

<body>
    <div id="header"></div>



    <section class="section">
        <h2>Cómo empezar</h2>
        <div class="video-container">
            <video controls>
                <source src="tutorial.mp4" type="video/mp4">
                Tu navegador no soporta videos.
            </video>
        </div>
    </section>
    <section class="section" id="section2">
        <h2>Nuestros Sensores</h2>
        <div class="sensor-container">
            <button class="carousel-control-prev" type="button" data-bs-target="#sensorCarousel" data-bs-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            </button>
            <div id="sensorCarousel" class="carousel slide">
                <div class="carousel-inner">
                    <div class="carousel-item active">
                        <div class="sensor-box">
                            <div class="sensor-header">No hay sensores visitados recientemente</div>
                            <div class="chart-container" id="sensorChart1"></div>
                        </div>
                    </div>
                    
                </div>
            </div>
            <button class="carousel-control-next" type="button" data-bs-target="#sensorCarousel" data-bs-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
            </button>
        </div>
    </section>
    <section class="section">
        <h2>Últimas novedades</h2>
        <div class="news-carousel">
            <button id="prevNews" class="carousel-btn">&#10094;</button>
            <div id="news-container" class="news-item">
                <p>Cargando noticias...</p>
            </div>
            <button id="nextNews" class="carousel-btn">&#10095;</button>
        </div>
    </section>

    
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <script src="js/funcionChart.js"></script>

    <script>
        async function verificarSesion() {
        const response = await fetch("http://ambisensepruebaapi.us-east-1.elasticbeanstalk.com/auth/validate", {
            method: "GET",
            credentials: "include"  // Permite enviar cookies
        });
    
        if (response.ok) {
            const data = await response.text();
            console.log("Sesión activa:", data);
        } else {
            console.log("No hay sesión activa.");
        }
    }
    
    window.onload = verificarSesion;
    
    </script>

<script>
    async function obtenerDatosProtegidos() {
    try {
        const response = await fetch("http://ambisensepruebaapi.us-east-1.elasticbeanstalk.com/public/datos", {
            method: "GET",
            credentials: "include",  // Permite enviar cookies en la solicitud
            headers: {
                "Content-Type": "application/json"
            }
        });

        if (response.ok) {
            const data = await response.text();  // O response.json() si devuelve JSON
            console.log("✅ Datos protegidos recibidos:", data);
            document.getElementById("resultado").innerText = data;
        } else {
            console.error("❌ Error al obtener datos: ", response.status);
            document.getElementById("resultado").innerText = "Acceso no autorizado.";
        }
    } catch (error) {
        console.error("⚠️ Error en la solicitud:", error);
        document.getElementById("resultado").innerText = "Error en la solicitud.";
    }
}

// Llamada automática al cargar la página
window.onload = () => {
    document.getElementById("btnDatos").addEventListener("click", obtenerDatosProtegidos);
};

</script>

</body>

</html>