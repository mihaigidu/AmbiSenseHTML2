<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>P치gina de Sensores</title>
    <link rel="icon" href="imagenes/FavIcon.png" type="image/x-icon">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link rel="stylesheet" href="css/header.css">
    <script defer src="js/header.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
    <!-- CSS del Footer -->
    <link rel="stylesheet" href="css/footer.css">

    <link rel="stylesheet" href="css/mainUsuario.css">
    <!-- JS del Footer -->
    <script src="js/footer.js" defer></script>


</head>

<body>
    <div id="header"></div>



    <section class="section">
        <h2>C칩mo empezar</h2>
        <div class="video-container">
            <video controls>
                <source src="tutorial.mp4" type="video/mp4">
                Tu navegador no soporta videos.
            </video>
        </div>
    </section>
    <section class="section">
        <h2>Nuestros Sensores</h2>
        <div class="sensor-container">
            <button class="carousel-control-prev" type="button" data-bs-target="#sensorCarousel" data-bs-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            </button>
            <div id="sensorCarousel" class="carousel slide">
                <div class="carousel-inner">
                    <div class="carousel-item active">
                        <div class="sensor-box">
                            <div class="sensor-header">Sensor 1: Temperatura y Humedad</div>
                            <div class="chart-container" id="sensorChart1"></div>
                        </div>
                    </div>
                    <div class="carousel-item">
                        <div class="sensor-box">
                            <div class="sensor-header">Sensor 2: Temperatura y Humedad</div>
                            <div class="chart-container" id="sensorChart2"></div>
                        </div>
                    </div>
                </div>
            </div>
            <button class="carousel-control-next" type="button" data-bs-target="#sensorCarousel" data-bs-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
            </button>
        </div>
    </section>
    <section class="section">
        <h2>칔ltimas novedades</h2>
        <div class="news-carousel">
            <button id="prevNews" class="carousel-btn">&#10094;</button>
            <div id="news-container" class="news-item">
                <p>Cargando noticias...</p>
            </div>
            <button id="nextNews" class="carousel-btn">&#10095;</button>
        </div>
    </section>


    <script>
        const API_KEY = "pub_69144306a0da375dd43f0c86ac65e851680f8";
        const API_URL = `https://newsdata.io/api/1/news?apikey=${API_KEY}&q=salud%20en%20las%20aulas&country=es`;
        let cachedArticles = [];
        let currentIndex = 0;

        async function fetchNews() {
            try {
                console.log("游댃 Intentando cargar noticias...");
                const response = await fetch(API_URL);
                const data = await response.json();

                if (!data.results || !Array.isArray(data.results) || data.results.length === 0) {
                    if (cachedArticles.length > 0) {
                        console.warn("丘멆잺 La API no devolvi칩 noticias nuevas. Mostrando noticias anteriores.");
                        displayNews();
                        return;
                    } else {
                        throw new Error("No hay noticias disponibles en este momento.");
                    }
                }

                let uniqueArticles = Array.from(new Set(data.results.map(a => a.title)))
                    .map(title => data.results.find(a => a.title === title));

                cachedArticles = shuffleArray(uniqueArticles).slice(0, 5);
                currentIndex = 0; // Reiniciar 칤ndice al recibir nuevas noticias
                displayNews();

            } catch (error) {
                console.error("丘멆잺 Error al cargar noticias:", error);
                if (cachedArticles.length > 0) {
                    console.warn("丘멆잺 Error en la API, pero mostrando noticias anteriores.");
                    displayNews();
                } else {
                    document.getElementById("news-container").innerHTML = `<p>Error: ${error.message}</p>`;
                }
            }
        }

        function displayNews() {
            let newsContainer = document.getElementById("news-container");
            if (cachedArticles.length > 0) {
                const article = cachedArticles[currentIndex];
                newsContainer.innerHTML = `
                    <h3>${article.title}</h3>
                    <p>${article.description || "No hay descripci칩n disponible."}</p>
                    <a href="${article.link}" target="_blank">Leer m치s</a>
                `;
            } else {
                newsContainer.innerHTML = `<p>No hay noticias disponibles.</p>`;
            }
        }

        document.getElementById("prevNews").addEventListener("click", () => {
            if (cachedArticles.length > 0) {
                currentIndex = (currentIndex - 1 + cachedArticles.length) % cachedArticles.length;
                displayNews();
            }
        });

        document.getElementById("nextNews").addEventListener("click", () => {
            if (cachedArticles.length > 0) {
                currentIndex = (currentIndex + 1) % cachedArticles.length;
                displayNews();
            }
        });

        function shuffleArray(array) {
            return array.sort(() => Math.random() - 0.5);
        }

        fetchNews();
        setInterval(fetchNews, 300000);
    </script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <script defer src="js/funcionChart.js"></script>
</body>

</html>