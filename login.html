<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Login - Analizador de Salubridad</title>

  <!-- Bootstrap CSS -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
  <!-- Font Awesome -->
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css"
    crossorigin="anonymous"
    referrerpolicy="no-referrer"
  />
  <link rel="stylesheet" href="css/login.css">
  
</head>
<body>

  <video autoplay loop muted class="background-video">
    <source src="imagenes/VID-20250129-WA0019.mp4" type="video/mp4">
    Tu navegador no soporta videos.
  </video>

  <div class="login-container" id="loginContainer">
    <!-- Cara frontal: Login -->
    <div class="card card-front">
      <form id="loginForm">
        <h2 class="login-title">Iniciar Sesión</h2>

        <!-- Correo Electrónico (Login) -->
        <div class="mb-3">
          <label for="correoElectronico" class="form-label">Correo Electrónico</label>
          <input
            type="text"
            class="form-control"
            id="correoElectronico"
            name="correoElectronico"
            placeholder="Ingrese su Correo Electrónico"
            required
          />
          <!-- Reglas de email para el LOGIN -->
          <div class="email-rules" id="emailRulesLogin">
            <p id="login-emailformat">Debe tener un formato de email válido (usuario@dominio.com)</p>
          </div>
        </div>

        <!-- Contraseña (Login) -->
        <div class="mb-3">
          <label for="password" class="form-label">Contraseña</label>
          <input
            type="password"
            class="form-control"
            id="password"
            name="password"
            placeholder="Ingrese su contraseña"
            required
          />
          <!-- Reglas de contraseña para el LOGIN -->
          <div class="password-rules" id="passwordRulesLogin">
            <p id="login-length">Mínimo 8 caracteres</p>
            <p id="login-uppercase">Al menos 1 mayúscula</p>
            <p id="login-digit">Al menos 1 dígito</p>
          </div>
        </div>

        <button type="submit" class="btn btn-login">Ingresar</button>
        
        <!-- Botón de Google con ícono -->
        <button type="button" class="btn btn-google" id="googleLogin">
          <i class="fa-brands fa-google me-2"></i>
          Iniciar sesión con Google
        </button>
        
        <!-- Botón de GitHub con ícono -->
        <button type="button" class="btn btn-github" id="githubLogin">
          <i class="fa-brands fa-github me-2"></i>
          Iniciar sesión con GitHub
        </button>
      </form>
      <p class="footer-text">
        ¿No tienes una cuenta? <a href="#" id="registerLink">Regístrate aquí</a>
      </p>
    </div>

    <!-- Cara trasera: Registro -->
    <div class="card card-back">
      <form id="registerForm">
        <h2 class="login-title">Regístrate</h2>

        <!-- Nombre Completo -->
        <div class="mb-3">
          <label for="fullname" class="form-label">Nombre Completo</label>
          <input
            type="text"
            class="form-control"
            id="fullname"
            name="fullname"
            placeholder="Ingrese su nombre completo"
            required
          />
        </div>

        <!-- Correo Electrónico (Registro) -->
        <div class="mb-3">
          <label for="email" class="form-label">Correo Electrónico</label>
          <input
            type="email"
            class="form-control"
            id="email"
            name="email"
            placeholder="Ingrese su correo electrónico"
            required
          />
          <!-- Reglas de email para REGISTRO -->
          <div class="email-rules" id="emailRulesRegister">
            <p id="register-emailformat">Debe tener un formato de email válido (usuario@dominio.com)</p>
          </div>
        </div>

        <!-- Contraseña (Registro) -->
        <div class="mb-3">
          <label for="passwordReg" class="form-label">Contraseña</label>
          <input
            type="password"
            class="form-control"
            id="passwordReg"
            name="passwordReg"
            placeholder="Cree una contraseña"
            required
          />
          <!-- Reglas de contraseña para el REGISTRO -->
          <div class="password-rules" id="passwordRulesReg">
            <p id="reg-length">Mínimo 8 caracteres</p>
            <p id="reg-uppercase">Al menos 1 mayúscula</p>
            <p id="reg-digit">Al menos 1 dígito</p>
          </div>
        </div>

        <button type="submit" class="btn btn-login">Registrarse</button>
      </form>
      <p class="footer-text">
        ¿Ya tienes una cuenta? <a href="#" id="backToLoginLink">Inicia sesión aquí</a>
      </p>
    </div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const loginContainer = document.getElementById("loginContainer");
      const registerLink = document.getElementById("registerLink");
      const backToLoginLink = document.getElementById("backToLoginLink");

      // Navegación entre Login y Registro
      registerLink.addEventListener("click", function (event) {
        event.preventDefault();
        loginContainer.classList.add("rotated");
        loginContainer.style.minHeight = "550px";
      });
      backToLoginLink.addEventListener("click", function (event) {
        event.preventDefault();
        loginContainer.classList.remove("rotated");
        loginContainer.style.minHeight = "450px";
      });

      // ---- LOGIN ----
      const loginForm = document.getElementById("loginForm");
      const emailLogin = document.getElementById("correoElectronico");
      const passwordLogin = document.getElementById("password");

      // Mostrar/ocultar reglas de email (Login)
      emailLogin.addEventListener("focus", () => {
        document.getElementById("emailRulesLogin").style.display = "block";
      });
      emailLogin.addEventListener("blur", () => {
        document.getElementById("emailRulesLogin").style.display = "none";
      });
      emailLogin.addEventListener("input", () => {
        checkEmailRules(emailLogin.value, "login-emailformat");
      });

      // Mostrar/ocultar reglas de contraseña (Login)
      passwordLogin.addEventListener("focus", () => {
        document.getElementById("passwordRulesLogin").style.display = "block";
      });
      passwordLogin.addEventListener("blur", () => {
        document.getElementById("passwordRulesLogin").style.display = "none";
      });
      passwordLogin.addEventListener("input", () => {
        checkPasswordRules(passwordLogin.value, "login-");
      });

      // Validación final al enviar el formulario de LOGIN
      loginForm.addEventListener("submit", function (event) {
        if (!isEmailValid(emailLogin.value)) {
          event.preventDefault();
          alert("El correo electrónico no cumple el formato válido (usuario@dominio.com).");
          return;
        }
        if (!isPasswordValid(passwordLogin.value)) {
          event.preventDefault();
          alert("La contraseña no cumple los requisitos indicados.");
        }
      });

      // ---- REGISTRO ----
      const registerForm = document.getElementById("registerForm");
      const emailRegister = document.getElementById("email");
      const passwordReg = document.getElementById("passwordReg");

      // Mostrar/ocultar reglas de email (Registro)
      emailRegister.addEventListener("focus", () => {
        document.getElementById("emailRulesRegister").style.display = "block";
      });
      emailRegister.addEventListener("blur", () => {
        document.getElementById("emailRulesRegister").style.display = "none";
      });
      emailRegister.addEventListener("input", () => {
        checkEmailRules(emailRegister.value, "register-emailformat");
      });

      // Mostrar/ocultar reglas de contraseña (Registro)
      passwordReg.addEventListener("focus", () => {
        document.getElementById("passwordRulesReg").style.display = "block";
      });
      passwordReg.addEventListener("blur", () => {
        document.getElementById("passwordRulesReg").style.display = "none";
      });
      passwordReg.addEventListener("input", () => {
        checkPasswordRules(passwordReg.value, "reg-");
      });

      // Validación final al enviar el formulario de REGISTRO
      registerForm.addEventListener("submit", function (event) {
        // Validar email
        if (!isEmailValid(emailRegister.value)) {
          event.preventDefault();
          alert("El correo electrónico no cumple el formato válido (usuario@dominio.com).");
          return;
        }
        // Validar password
        if (!isPasswordValid(passwordReg.value)) {
          event.preventDefault();
          alert("La contraseña no cumple los requisitos indicados.");
        }
      });

      // ---- Funciones de validación ----

      // Verifica formato de email (muy básico)
      function isEmailValid(email) {
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return emailRegex.test(email);
      }

      // Muestra/oculta la regla de email (si se cumple o no)
      function checkEmailRules(email, ruleId) {
        const ruleEl = document.getElementById(ruleId);
        if (isEmailValid(email)) {
          ruleEl.style.display = "none";
        } else {
          ruleEl.style.display = "block";
        }
      }

      // Verifica si la contraseña cumple 3 reglas
      function isPasswordValid(password) {
        return (
          password.length >= 8 &&
          /[A-Z]/.test(password) &&
          /\d/.test(password)
        );
      }

      // Muestra/oculta reglas de contraseña
      function checkPasswordRules(password, prefix) {
        const lengthEl = document.getElementById(prefix + "length");
        const uppercaseEl = document.getElementById(prefix + "uppercase");
        const digitEl = document.getElementById(prefix + "digit");

        if (password.length >= 8) {
          lengthEl.style.display = "none";
        } else {
          lengthEl.style.display = "block";
        }
        if (/[A-Z]/.test(password)) {
          uppercaseEl.style.display = "none";
        } else {
          uppercaseEl.style.display = "block";
        }
        if (/\d/.test(password)) {
          digitEl.style.display = "none";
        } else {
          digitEl.style.display = "block";
        }
      }

      // Botones de Login con Google y GitHub
      document.getElementById("googleLogin").addEventListener("click", function () {
        window.location.href = "http://ambisensepruebaapi.us-east-1.elasticbeanstalk.com/oauth2/authorization/google";
      });
      document.getElementById("githubLogin").addEventListener("click", function () {
        window.location.href = "http://ambisensepruebaapi.us-east-1.elasticbeanstalk.com/oauth2/authorization/github";
      });
    });
  </script>
</body>
</html>
